package com.ymsli.bank.inhouse.controller;

import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

import com.ymsli.bank.inhouse.dto.LoginRequest;
import com.ymsli.bank.inhouse.dto.LoginResponse;
import com.ymsli.bank.inhouse.model.User;
import com.ymsli.bank.inhouse.repository.UserRepository;
import com.ymsli.bank.inhouse.security.JwtUtil;
@RestController
@RequestMapping("/auth")
public class AuthController {
	
	private final UserRepository userRepository;
	
	public AuthController(UserRepository userRepository) {
		this.userRepository=userRepository;
	}
	
	@PostMapping("/login")
	public LoginResponse login(@RequestBody LoginRequest request) {
		System.out.println("login API hit");
		User user = userRepository.findAll().stream()
				.filter(u -> u.getUsername().equals(u.getUsername())
						&& u.getPassword().equals(u.getPassword()))
						.findFirst()
						.orElseThrow(() -> new RuntimeException("Invalid credentials"));
		
		
		String token =  JwtUtil.generateToken(user.getId(), user.getRole().name());
		return new LoginResponse(token);
						
	}

}
