package com.ymsli.bank.inhouse.security;

import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;

import com.ymsli.bank.inhouse.dto.LoginRequest;
import com.ymsli.bank.inhouse.dto.LoginResponse;
import com.ymsli.bank.inhouse.model.User;
import com.ymsli.bank.inhouse.repository.UserRepository;

public class AuthController {
	
	private final UserRepository userRepository;
	
	public AuthController(UserRepository userRepository) {
		this.userRepository=userRepository;
	}
	
	@PostMapping("/login")
	public LoginResponse login(@RequestBody LoginRequest request) {
		User user = userRepository.findAll().stream()
				.filter(u -> u.getUsername().equals(request.getUsername())
						&& u.getPassword().equals(request.getPassword()))
						.findFirst()
						.orElseThrow(() -> new RuntimeException("Invalid credentials"));
		
		
		String token =  JwtUtil.generateToken(user.getId(), user.getRole().name());
		return new LoginResponse(token);
						
	}

}
